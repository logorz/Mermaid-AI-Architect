(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{516:function(e,t,a){Promise.resolve().then(a.bind(a,2320))},2320:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return S}});var r=a(7437),s=a(2265),l=a(1924),n=a(2484),o=a(9492),d=a(2137),i=a(3836),c=a(7165),m=a(7233);let x=(e,t)=>{let a=e.match(/%%\{init:\s*({[\s\S]*?})\s*\}%%/),r={themeVariables:{},theme:"base"},s="",l=e;if(a)try{let t=JSON.parse(a[1]);(r={...r,...t}).themeVariables||(r.themeVariables={}),s=e.substring(0,a.index),l=e.substring(a.index+a[0].length)}catch(e){console.warn("Failed to parse existing init config",e)}Object.entries(t).forEach(e=>{let[t,a]=e;r.themeVariables[t]=a});let n="%%{init: ".concat(JSON.stringify(r)," }%%");return"".concat(s).concat(n,"\n").concat(l.trim())},b=(e,t)=>{let a=e.match(/%%\{init:\s*({[\s\S]*?})\s*\}%%/);if(a)try{var r;let e=JSON.parse(a[1]);return(null===(r=e.themeVariables)||void 0===r?void 0:r[t])||""}catch(e){}return""},h=e=>{let{code:t,uid:a,onFixError:h,isFixing:u,allowFullscreen:g=!0,onUpdateCode:p,onRequestChange:f}=e,v=(0,s.useRef)(null),[k,w]=(0,s.useState)(""),[j,y]=(0,s.useState)(null),[N,C]=(0,s.useState)(1),[S,D]=(0,s.useState)({x:0,y:0}),[E,I]=(0,s.useState)(!1),[R,M]=(0,s.useState)({x:0,y:0}),[A,L]=(0,s.useState)(!1),[z,O]=(0,s.useState)(!1),[T,P]=(0,s.useState)({}),[F,U]=(0,s.useState)({textColor:"",primaryColor:"",lineColor:""}),[Z,q]=(0,s.useState)(!1),[B,_]=(0,s.useState)(""),[G,J]=(0,s.useState)(!1),V=(0,s.useMemo)(()=>Array.from(new Set(t.match(/#([0-9a-fA-F]{3,6})\b/g)||[])),[t]);(0,s.useEffect)(()=>{z&&(U({textColor:b(t,"textColor")||"#333333",primaryColor:b(t,"primaryColor")||"#ffffff",lineColor:b(t,"lineColor")||"#333333"}),P({}))},[z,t]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(z?O(!1):A&&X())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[A,z]),(0,s.useEffect)(()=>{let e=()=>{let e=v.current;e&&(document.documentElement.classList.contains("dark")?(e.style.backgroundColor="#0f172a",e.style.backgroundImage="\n            linear-gradient(to right, rgba(99, 102, 241, 0.15) 1px, transparent 1px),\n            linear-gradient(to bottom, rgba(99, 102, 241, 0.15) 1px, transparent 1px)\n          "):(e.style.backgroundColor="#ffffff",e.style.backgroundImage="\n            linear-gradient(to right, rgba(99, 102, 241, 0.08) 1px, transparent 1px),\n            linear-gradient(to bottom, rgba(99, 102, 241, 0.08) 1px, transparent 1px)\n          "))};e();let t=new MutationObserver(e);return t.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>t.disconnect()},[]),(0,s.useEffect)(()=>{let e=!0,r=async()=>{if(t&&v.current&&window.mermaid)try{y(null);let r=document.documentElement.classList.contains("dark"),s=/%%\{init:/.test(t);window.mermaid.initialize({startOnLoad:!1,theme:s?"base":r?"dark":"default",securityLevel:"loose",fontFamily:"Fira Code, monospace"});let l="mermaid-".concat(a||Date.now(),"-").concat(Math.random().toString(36).substr(2,6)),{svg:n}=await window.mermaid.render(l,t);e&&w(n)}catch(t){e&&(console.warn("Mermaid Render Error:",t.message),y(t.message||"语法错误 (Syntax Error)"))}},s=setTimeout(r,100),l=new MutationObserver(r);return l.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>{e=!1,clearTimeout(s),l.disconnect()}},[t,a]);let Y=()=>I(!1),X=()=>{g&&(L(!A),A||(C(1),D({x:0,y:0})))},H=async()=>{if(B.trim()&&!G){J(!0);try{setTimeout(()=>{q(!1),_(""),f&&f(t)},1e3)}catch(e){console.error("Chat error:",e)}finally{J(!1)}}},K=A?"fixed inset-0 z-50 bg-slate-50 dark:bg-slate-950 flex flex-col":"flex flex-col items-center justify-center w-full h-full bg-slate-100 dark:bg-slate-900/50 relative group overflow-hidden transition-colors duration-300";return(0,r.jsxs)("div",{className:K,children:[(0,r.jsxs)("div",{className:"absolute top-4 right-4 z-20 flex flex-col items-end gap-2 transition-opacity ".concat(!A&&"opacity-0 group-hover:opacity-100"," ").concat(j?"hidden":""),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[A&&(0,r.jsxs)("button",{onClick:X,className:"bg-slate-200/80 dark:bg-slate-800/80 backdrop-blur text-xs px-4 py-2 rounded-full border border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:text-white hover:bg-red-500 dark:hover:bg-red-600 shadow-lg flex items-center gap-2 font-bold transition-all",children:[(0,r.jsx)(l.Z,{className:"w-4 h-4"}),"退出 (ESC)"]}),!A&&g&&(0,r.jsxs)("button",{onClick:X,className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur text-xs px-3 py-1.5 rounded-full border border-slate-300 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:text-brand-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-700 shadow-lg flex items-center gap-1.5",children:[(0,r.jsx)(n.Z,{className:"w-3 h-3"}),"实时预览"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 bg-white/90 dark:bg-slate-800/90 backdrop-blur rounded-lg border border-slate-300 dark:border-slate-700 p-1 shadow-xl",children:[(0,r.jsx)("button",{onClick:()=>O(!z),className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors ".concat(z?"text-brand-500 bg-brand-50 dark:bg-brand-900/20":"text-slate-500 dark:text-slate-400"),title:"颜色编辑器",children:(0,r.jsx)(o.Z,{className:"w-4 h-4"})}),(0,r.jsx)("div",{className:"w-px h-4 bg-slate-300 dark:bg-slate-600 mx-1"}),(0,r.jsx)("button",{onClick:()=>C(e=>Math.max(e-.2,.1)),className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700 rounded text-slate-500 dark:text-slate-400",title:"缩小",children:(0,r.jsx)(d.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>{C(1),D({x:0,y:0})},className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700 rounded text-slate-500 dark:text-slate-400",title:"复位",children:(0,r.jsx)("span",{children:"\uD83D\uDD04"})}),(0,r.jsx)("button",{onClick:()=>C(e=>Math.min(e+.2,10)),className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700 rounded text-slate-500 dark:text-slate-400",title:"放大",children:(0,r.jsx)(i.Z,{className:"w-4 h-4"})}),(0,r.jsx)("div",{className:"w-px h-4 bg-slate-300 dark:bg-slate-600 mx-1"}),f&&(0,r.jsx)("button",{onClick:()=>q(!0),className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700 rounded text-slate-500 dark:text-slate-400 border-l border-slate-200 dark:border-slate-700 ml-1",title:"提需求",children:(0,r.jsx)("span",{children:"\uD83D\uDCAC"})}),g&&(0,r.jsx)("button",{onClick:X,className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700 rounded text-slate-500 dark:text-slate-400 border-l border-slate-200 dark:border-slate-700 ml-1",children:A?(0,r.jsx)(l.Z,{className:"w-4 h-4"}):(0,r.jsx)(n.Z,{className:"w-4 h-4"})})]}),z&&p&&(0,r.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-2xl mt-2 w-64 animate-in slide-in-from-top-2 duration-200 flex flex-col overflow-hidden",children:[(0,r.jsx)("div",{className:"p-3 border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50",children:(0,r.jsx)("h3",{className:"text-xs font-bold text-slate-800 dark:text-slate-200 uppercase tracking-wider",children:"图表配色"})}),(0,r.jsxs)("div",{className:"p-4 space-y-4 max-h-[300px] overflow-y-auto",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] font-semibold text-slate-400 mb-2 uppercase",children:"全局设置"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-xs text-slate-600 dark:text-slate-300",children:"文本颜色"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("input",{type:"color",className:"w-6 h-6 rounded cursor-pointer border-0 p-0 bg-transparent",value:F.textColor,onChange:e=>U({...F,textColor:e.target.value})})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-xs text-slate-600 dark:text-slate-300",children:"线条/边框"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("input",{type:"color",className:"w-6 h-6 rounded cursor-pointer border-0 p-0 bg-transparent",value:F.lineColor,onChange:e=>U({...F,lineColor:e.target.value})})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-xs text-slate-600 dark:text-slate-300",children:"默认填充"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("input",{type:"color",className:"w-6 h-6 rounded cursor-pointer border-0 p-0 bg-transparent",value:F.primaryColor,onChange:e=>U({...F,primaryColor:e.target.value})})})]})]})]}),V.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] font-semibold text-slate-400 mb-2 uppercase",children:"替换现有颜色"}),(0,r.jsx)("div",{className:"grid grid-cols-5 gap-2",children:V.map(e=>{let t=T[e]||e;return(0,r.jsx)("div",{className:"relative group w-8 h-8 rounded-full shadow-sm border border-slate-200 dark:border-slate-600 overflow-hidden ring-offset-1 dark:ring-offset-slate-800 hover:ring-2 ring-brand-500 transition-all",children:(0,r.jsx)("input",{type:"color",value:t,title:"Replace ".concat(e),onChange:t=>P(a=>({...a,[e]:t.target.value})),className:"absolute inset-0 w-[150%] h-[150%] -top-1/4 -left-1/4 cursor-pointer p-0 border-0"})},e)})})]})]}),(0,r.jsxs)("div",{className:"p-3 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-100 dark:border-slate-700 flex gap-2",children:[(0,r.jsxs)("button",{onClick:()=>{O(!1),P({})},className:"flex-1 py-1.5 px-3 text-xs font-medium text-slate-600 dark:text-slate-300 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors flex items-center justify-center gap-1",children:[(0,r.jsx)(c.Z,{className:"w-3 h-3"})," 取消"]}),(0,r.jsxs)("button",{onClick:()=>{if(!p)return;let e=t,a={};F.textColor&&(a.primaryTextColor=F.textColor),F.primaryColor&&(a.primaryColor=F.primaryColor),F.lineColor&&(a.lineColor=F.lineColor),Object.keys(a).length>0&&(e=x(e,a)),Object.entries(T).forEach(t=>{let[a,r]=t;e=e.replaceAll(a,r)}),p(e),O(!1)},className:"flex-1 py-1.5 px-3 text-xs font-medium text-white bg-brand-600 hover:bg-brand-500 rounded shadow-sm transition-colors flex items-center justify-center gap-1",children:[(0,r.jsx)(m.Z,{className:"w-3 h-3"})," 应用更改"]})]})]})]}),j&&(0,r.jsxs)("div",{className:"absolute top-4 left-4 right-4 bg-red-50 border border-red-200 dark:bg-red-500/10 dark:border-red-500/50 text-red-700 dark:text-red-200 p-3 rounded backdrop-blur-md z-30 text-xs font-mono break-all flex items-start justify-between gap-4 shadow-lg",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-bold mb-1",children:"渲染错误:"}),(0,r.jsx)("p",{children:j})]}),h&&(0,r.jsxs)("button",{onClick:()=>h(t,j),disabled:u,className:"flex items-center gap-1 bg-red-100 hover:bg-red-200 dark:bg-red-500/20 dark:hover:bg-red-500/40 border border-red-200 dark:border-red-500/50 text-red-800 dark:text-red-100 px-3 py-1.5 rounded transition-colors whitespace-nowrap text-xs font-bold",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4 ".concat(u?"animate-spin":"")}),u?"修复中...":"AI 自动修复"]})]}),(0,r.jsx)("div",{ref:v,className:"w-full h-full overflow-hidden cursor-grab active:cursor-grabbing ".concat(j?"opacity-30 pointer-events-none":"opacity-100"),style:{backgroundColor:"#ffffff",backgroundImage:"\n            linear-gradient(to right, rgba(99, 102, 241, 0.08) 1px, transparent 1px),\n            linear-gradient(to bottom, rgba(99, 102, 241, 0.08) 1px, transparent 1px)\n          ",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 0"},onWheel:e=>{e.ctrlKey||e.metaKey,C(Math.min(Math.max(.1,N-.001*e.deltaY),10))},onMouseDown:e=>{0===e.button&&(I(!0),M({x:e.clientX-S.x,y:e.clientY-S.y}))},onMouseMove:e=>{E&&D({x:e.clientX-R.x,y:e.clientY-R.y})},onMouseUp:Y,onMouseLeave:Y,children:(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center origin-center transition-transform duration-75 ease-out",style:{transform:"translate(".concat(S.x,"px, ").concat(S.y,"px) scale(").concat(N,")")},dangerouslySetInnerHTML:{__html:k},id:"mermaid-chart-container"})}),!A&&(0,r.jsx)("div",{className:"absolute bottom-4 left-4 text-[10px] text-slate-400 dark:text-slate-500 select-none pointer-events-none",children:"Ctrl + 滚轮缩放 | 拖拽移动"}),Z&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-2xl max-w-md w-full max-h-[80vh] flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"font-bold text-lg text-slate-800 dark:text-slate-200",children:"提需求"}),(0,r.jsx)("button",{onClick:()=>q(!1),className:"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full text-slate-500 dark:text-slate-400",children:(0,r.jsx)(c.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("div",{className:"p-4 flex-1 overflow-y-auto",children:[(0,r.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"请描述您对当前流程图的修改需求，我会根据您的描述进行调整。"}),(0,r.jsx)("textarea",{value:B,onChange:e=>_(e.target.value),placeholder:"例如：我想在流程图中添加一个新的步骤，用于验证用户身份...",className:"w-full p-3 border border-slate-300 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none h-40",disabled:G})]}),(0,r.jsxs)("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 flex items-center justify-end gap-3",children:[(0,r.jsx)("button",{onClick:()=>q(!1),className:"px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors",disabled:G,children:"取消"}),(0,r.jsx)("button",{onClick:H,className:"px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:G||!B.trim(),children:G?"处理中...":"提交需求"})]})]})})]})},u=[{value:"auto",label:"自动识别 (Auto)"},{value:"graph",label:"流程图 (Flowchart)"},{value:"sequence",label:"时序图 (Sequence)"},{value:"class",label:"类图 (Class)"},{value:"state",label:"状态图 (State)"},{value:"gantt",label:"甘特图 (Gantt)"},{value:"mindmap",label:"思维导图 (Mindmap)"},{value:"er",label:"ER 图 (Entity Relationship)"},{value:"journey",label:"用户旅程 (Journey)"}],g=[{name:"流程图 (Flowchart)",type:"graph",description:"展示决策路径和流程步骤 (使用新版引擎)",code:'flowchart TD\n    A["开始"] --> B{"是否注册?"}\n    B -- "是" --> C["登录系统"]\n    B -- "否" --> D["跳转注册页"]\n    C --> E["进入首页"]\n    D --> B\n    style A fill:#22c55e,stroke:#333,stroke-width:2px'},{name:"时序图 (Sequence)",type:"sequence",description:"展示对象之间的交互顺序",code:'sequenceDiagram\n    participant U as "用户"\n    participant S as "服务器"\n    participant D as "数据库"\n    U->>S: "请求数据"\n    S->>D: "查询 SQL"\n    D-->>S: "返回结果"\n    S-->>U: "渲染页面"'},{name:"甘特图 (Gantt)",type:"gantt",description:"项目进度与时间管理",code:'gantt\n    title "项目开发计划"\n    dateFormat YYYY-MM-DD\n    section "设计"\n    "原型设计" :a1, 2024-01-01, 5d\n    "UI设计"   :after a1, 5d\n    section "开发"\n    "后端API"  :2024-01-06, 10d\n    "前端联调" :after a1, 8d'},{name:"类图 (Class)",type:"class",description:"面向对象的类结构",code:"classDiagram\n    class 动物 {\n      +String 名字\n      +eat()\n    }\n    class 鸭子 {\n      +swim()\n    }\n    动物 <|-- 鸭子"},{name:"状态图 (State)",type:"state",description:"系统状态流转",code:'stateDiagram-v2\n    [*] --> 闲置\n    闲置 --> 处理中 : "接收任务"\n    处理中 --> 完成 : "任务结束"\n    处理中 --> 错误 : "异常发生"\n    错误 --> 闲置 : "重置"\n    完成 --> [*]'},{name:"实体关系图 (ER)",type:"er",description:"数据库结构关系",code:"erDiagram\n    CUSTOMER ||--o{ ORDER : places\n    ORDER ||--|{ LINE-ITEM : contains\n    CUSTOMER {\n      string name\n      string email\n    }"},{name:"饼图 (Pie)",type:"pie",description:"数据占比统计",code:'pie title "市场份额"\n    "产品 A" : 40\n    "产品 B" : 30\n    "产品 C" : 20\n    "其他" : 10'},{name:"用户旅程 (Journey)",type:"journey",description:"用户体验路径",code:'journey\n    title "购物体验"\n    section "浏览"\n      "搜索商品": 5: "用户"\n      "查看详情": 4: "用户"\n    section "购买"\n      "加入购物车": 5: "用户"\n      "支付失败": 2: "用户", "系统"'},{name:"Git 提交图 (GitGraph)",type:"git",description:"版本控制分支记录",code:"gitGraph\n    commit\n    commit\n    branch develop\n    checkout develop\n    commit\n    commit\n    checkout main\n    merge develop"},{name:"思维导图 (Mindmap)",type:"mindmap",description:"脑暴与层级结构",code:'mindmap\n  root(("人工智能"))\n    "机器学习"\n      "监督学习"\n      "无监督学习"\n    "深度学习"\n      "CNN"\n      "RNN"\n    "自然语言处理"'},{name:"时间轴 (Timeline)",type:"timeline",description:"历史事件记录",code:'timeline\n    title "公司发展史"\n    2020 : "成立" : "获得天使轮"\n    2021 : "发布 1.0" : "用户破万"\n    2022 : "扩张" : "融资 A 轮"'},{name:"象限图 (Quadrant)",type:"quadrant",description:"四象限分析矩阵",code:'quadrantChart\n    x-axis "低投入" --> "高投入"\n    y-axis "低回报" --> "高回报"\n    quadrant-1 "重点攻克"\n    quadrant-2 "快速赢取"\n    quadrant-3 "应当放弃"\n    quadrant-4 "缓慢积累"\n    "项目 A": [0.3, 0.6]\n    "项目 B": [0.45, 0.23]'}];g.slice(0,3);var p=a(8487),f=a(1801);let v=e=>{let{history:t,onSendMessage:a,isLoading:l,onOptimizeText:n}=e,[o,d]=(0,s.useState)(""),[i,m]=(0,s.useState)(null),[x,b]=(0,s.useState)("auto"),[h,g]=(0,s.useState)(!1),v=(0,s.useRef)(null),k=(0,s.useRef)(null),w=()=>{var e;null===(e=v.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,s.useEffect)(()=>{w()},[t]);let j=async e=>{null==e||e.preventDefault(),(o.trim()||i)&&!l&&(d(""),m(null),k.current&&(k.current.value=""),await a(o,i||void 0,x))},y=async()=>{if(o.trim()&&n&&!h){g(!0);try{let e=await n(o);d(e)}catch(e){console.error("AI 优化错误:",e)}finally{g(!1)}}},N=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.mimeType.startsWith("image/");return(0,r.jsxs)("div",{className:"relative inline-flex items-center gap-2 p-2 bg-slate-100 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 ".concat("mb-2"),children:[a?(0,r.jsx)("img",{src:e.content,alt:"Preview",className:"h-12 w-auto rounded border border-slate-300 dark:border-slate-600"}):(0,r.jsx)("div",{className:"h-12 w-12 flex items-center justify-center bg-white dark:bg-slate-700 rounded border border-slate-300 dark:border-slate-600 text-brand-500",children:(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCC4"})}),(0,r.jsxs)("div",{className:"flex flex-col justify-center max-w-[120px]",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-slate-700 dark:text-slate-200 truncate w-full",title:e.fileName,children:e.fileName||(a?"图片":"文件")}),(0,r.jsx)("span",{className:"text-[10px] text-slate-400 uppercase",children:e.mimeType.split("/")[1]})]}),t&&(0,r.jsx)("button",{onClick:()=>{m(null),k.current&&(k.current.value="")},className:"absolute -top-2 -right-2 bg-slate-100 dark:bg-slate-800 text-slate-500 hover:text-red-500 rounded-full p-1 border border-slate-300 dark:border-slate-600 shadow-sm",children:(0,r.jsx)(c.Z,{className:"w-3 h-3"})})]})};return(0,r.jsxs)("div",{className:"flex flex-col h-full bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-700 transition-colors duration-300",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/30",children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold text-brand-600 dark:text-brand-300 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"w-2 h-2 rounded-full bg-brand-500 animate-pulse"}),"AI 架构师"]}),(0,r.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"支持 PDF 文档解析与图片识别"})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===t.length&&(0,r.jsxs)("div",{className:"text-center text-slate-400 dark:text-slate-500 mt-10",children:[(0,r.jsx)("p",{children:"暂无消息。"}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"试试上传一个需求 PDF 或手绘草图"})]}),t.map(e=>(0,r.jsxs)("div",{className:"flex flex-col max-w-[90%] ".concat("user"===e.role?"ml-auto items-end":"mr-auto items-start"),children:["model"===e.role&&"message"===e.type&&(0,r.jsx)("div",{className:"mb-2 w-full",children:(0,r.jsxs)("button",{onClick:()=>a("基于以下对话内容生成流程图：".concat(e.content),void 0,"auto"),className:"w-full px-4 py-2 text-xs font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-700 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(p.Z,{className:"w-3 h-3"}),"基于对话内容生成流程图"]})}),(0,r.jsxs)("div",{className:"p-3 rounded-lg text-sm shadow-sm ".concat("user"===e.role?"bg-brand-600 text-white rounded-tr-none shadow-brand-500/20":"bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-200 rounded-tl-none border border-slate-200 dark:border-slate-600"," ").concat(e.isError?"bg-red-50 dark:bg-red-900/50 border-red-200 dark:border-red-500 text-red-800 dark:text-red-100":""),children:[e.attachment&&N(e.attachment,!1),(0,r.jsx)("p",{className:"whitespace-pre-wrap",children:e.content})]})]},e.id)),l&&(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-brand-500 dark:text-brand-400 text-sm p-2 animate-pulse",children:[(0,r.jsx)("span",{className:"w-4 h-4 animate-spin",children:"⟳"}),(0,r.jsx)("span",{children:"AI 正在阅读文档并构建图表..."})]}),(0,r.jsx)("div",{ref:v})]}),(0,r.jsxs)("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 transition-colors",children:[i&&N(i,!0),(0,r.jsxs)("form",{onSubmit:j,className:"relative flex flex-col gap-2",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("div",{className:"relative flex-1 max-w-[180px]",children:[(0,r.jsx)("select",{value:x,onChange:e=>b(e.target.value),className:"w-full appearance-none bg-white dark:bg-slate-900 text-slate-700 dark:text-slate-300 text-xs border border-slate-300 dark:border-slate-600 rounded px-2 py-1.5 focus:outline-none focus:border-brand-500 pr-6 transition-colors",children:u.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,r.jsx)(f.Z,{className:"absolute right-2 top-1.5 w-3 h-3 text-slate-500 pointer-events-none"})]})}),(0,r.jsx)("textarea",{value:o,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),j())},placeholder:"描述您的需求或上传文件... (Enter 换行, Ctrl+Enter 发送)",className:"w-full bg-white dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-xl pl-4 pr-12 py-3 text-sm focus:outline-none focus:ring-1 focus:ring-brand-500 focus:border-brand-500 resize-none scrollbar-hide text-slate-800 dark:text-slate-200 transition-colors placeholder:text-slate-400",rows:i?2:3}),(0,r.jsxs)("div",{className:"absolute right-2 bottom-2 flex items-center space-x-1",children:[(0,r.jsx)("input",{type:"file",ref:k,accept:"image/*,application/pdf",className:"hidden",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0],a=new FileReader;a.onload=e=>{var a;(null===(a=e.target)||void 0===a?void 0:a.result)&&m({content:e.target.result,mimeType:t.type,fileName:t.name})},a.readAsDataURL(t)}}}),(0,r.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.click()},className:"p-2 rounded-lg transition-colors ".concat(i?"text-brand-500 bg-brand-50 dark:bg-brand-900/20":"text-slate-400 hover:text-brand-500 hover:bg-slate-100 dark:hover:bg-slate-800"),title:"上传图片或 PDF",children:i?(0,r.jsx)("span",{children:"\uD83D\uDCCB"}):(0,r.jsx)("span",{children:"\uD83D\uDCF7"})}),n&&(0,r.jsx)("button",{type:"button",onClick:y,disabled:!o.trim()||h,className:"p-2 rounded-lg transition-colors ".concat(h?"text-brand-500 bg-brand-50 dark:bg-brand-900/20":"text-slate-400 hover:text-brand-500 hover:bg-slate-100 dark:hover:bg-slate-800"," disabled:opacity-50 disabled:cursor-not-allowed"),title:"AI 优化需求描述",children:(0,r.jsx)("span",{className:"w-5 h-5 flex items-center justify-center ".concat(h?"animate-spin":""),children:"✨"})}),(0,r.jsx)("button",{type:"submit",disabled:l||!o&&!i,className:"p-2 bg-brand-600 hover:bg-brand-500 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-brand-900/20",title:"Ctrl + Enter 发送",children:(0,r.jsx)("span",{children:"✈️"})})]})]})]})]})},k=e=>{let{code:t,onChange:a}=e;return(0,r.jsxs)("div",{className:"h-full flex flex-col bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-700 transition-colors duration-300",children:[(0,r.jsxs)("div",{className:"p-3 bg-slate-50 dark:bg-slate-800/30 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-xs font-mono text-slate-500 dark:text-slate-400",children:"mermaid.mmd"}),(0,r.jsx)("span",{className:"text-[10px] text-slate-400 dark:text-slate-500",children:"自动保存"})]}),(0,r.jsx)("textarea",{className:"flex-1 w-full h-full bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-300 font-mono text-sm p-4 focus:outline-none resize-none leading-relaxed transition-colors selection:bg-brand-200 dark:selection:bg-brand-900",value:t,onChange:e=>a(e.target.value),spellCheck:!1,placeholder:"在此输入 Mermaid 代码..."})]})},w=e=>{let{isOpen:t,onClose:a,onSelect:s}=e;return t?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 dark:bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 w-full max-w-6xl max-h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"图表类型库"}),(0,r.jsx)("p",{className:"text-slate-500 dark:text-slate-400 text-sm mt-1",children:"选择一个模板开始绘图"})]}),(0,r.jsx)("button",{onClick:a,className:"p-2 bg-slate-200 dark:bg-slate-800 hover:bg-slate-300 dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white rounded-full transition-colors",children:(0,r.jsx)(c.Z,{className:"w-6 h-6"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-slate-950 transition-colors",children:(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:g.map((e,t)=>(0,r.jsxs)("button",{onClick:()=>s(e),className:"group flex flex-col bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl overflow-hidden hover:border-brand-500/50 hover:shadow-lg hover:shadow-brand-500/10 transition-all duration-300 text-left",children:[(0,r.jsx)("div",{className:"h-40 bg-slate-100 dark:bg-slate-800/30 w-full relative overflow-hidden p-2 pointer-events-none border-b border-slate-100 dark:border-slate-800/50",children:(0,r.jsx)("div",{className:"absolute inset-0 transform scale-75 origin-top group-hover:scale-90 transition-transform duration-500",children:(0,r.jsx)(h,{code:e.code,uid:"gallery-".concat(t),allowFullscreen:!1})})}),(0,r.jsxs)("div",{className:"p-4 bg-white dark:bg-slate-900 group-hover:bg-slate-50 dark:group-hover:bg-slate-800/50 transition-colors",children:[(0,r.jsx)("h3",{className:"font-semibold text-slate-800 dark:text-slate-200 group-hover:text-brand-600 dark:group-hover:text-brand-300",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:e.description})]})]},e.name))})})]})}):null};class j{static async generateFromHistory(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";try{let r=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"generate",history:e,currentCode:t,diagramType:a})});if(!r.ok){let e=await r.json();throw Error(e.error||"API error: ".concat(r.status))}return await r.json()}catch(e){return console.error("API 调用错误:",e),{type:"message",content:"抱歉，连接 AI 服务时出现错误或超时，请重试。"}}}static async fixDiagram(e,t){try{let a=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"fix",code:e,errorMsg:t})});if(!a.ok){let e=await a.json();throw Error(e.error||"API error: ".concat(a.status))}return await a.json()}catch(e){throw console.error("API 调用错误:",e),Error("无法修复图表。")}}static async optimizePrompt(e){try{let t=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"optimize",prompt:e})});if(!t.ok){let e=await t.json();throw Error(e.error||"API error: ".concat(t.status))}return await t.json()}catch(t){return console.error("API 调用错误:",t),{type:"message",content:e}}}static cleanCode(e){let t=e.trim();return t.startsWith("```")&&(t=t.replace(/^```(mermaid)?\n?/,"").replace(/```$/,"")),(t=t.trim()).startsWith("graph ")&&(t=t.replace(/^graph /,"flowchart ")),t}}var y=a(2494),N=a(9158),C=a(1),S=()=>{let[e,t]=(0,s.useState)(g[0].code),[l,n]=(0,s.useState)([]),[o,d]=(0,s.useState)("chat"),[i,c]=(0,s.useState)(!1),[m,x]=(0,s.useState)(!1),[b,u]=(0,s.useState)(!1),[p,S]=(0,s.useState)(!0),[D,E]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=window.document.documentElement;p?e.classList.add("dark"):e.classList.remove("dark")},[p]);let I=async function(a,r){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";c(!0);let o=[...l,{id:Date.now().toString(),role:"user",content:a,attachment:r}];n(o);try{let a=await j.generateFromHistory(o,e,s);if("code"===a.type){t(a.content);let e={id:(Date.now()+1).toString(),role:"model",content:"✅ 已根据您的要求生成/更新了图表。\n如果细节不准确，您可以继续告诉我。",type:"code"};n(t=>[...t,e])}else{let e={id:(Date.now()+1).toString(),role:"model",content:a.content,type:"message"};n(t=>[...t,e])}}catch(t){let e={id:(Date.now()+1).toString(),role:"model",content:"抱歉，处理您的请求时遇到错误，请重试。",isError:!0};n(t=>[...t,e])}finally{c(!1)}},R=async(e,a)=>{x(!0);try{let r=await j.fixDiagram(e,a);t(r.code);let s={id:Date.now().toString(),role:"model",content:"\uD83D\uDD27 已修复语法错误。\n\n原因: ".concat(r.explanation)};n(e=>[...e,s]),"chat"!==o&&d("chat")}catch(e){alert("无法自动修复，请检查代码。")}finally{x(!1)}},M=()=>{let e=document.querySelector("#mermaid-chart-container svg");if(e){let t=new Blob([new XMLSerializer().serializeToString(e)],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="mermaid-diagram-".concat(Date.now(),".svg"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}else alert("没有可下载的图表渲染内容。")},A=()=>{let e=document.querySelector("#mermaid-chart-container svg");if(e){let t=new XMLSerializer().serializeToString(e),a=document.createElement("canvas"),r=a.getContext("2d");if(!r)return;let s=new Image;s.onload=()=>{a.width=3*s.width,a.height=3*s.height;let e=document.documentElement.classList.contains("dark");r.fillStyle=e?"#0f172a":"#ffffff",r.fillRect(0,0,a.width,a.height),r.drawImage(s,0,0,a.width,a.height),a.toBlob(e=>{if(e){let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="mermaid-diagram-".concat(Date.now(),".png"),document.body.appendChild(a),a.click(),document.body.removeChild(a)}},"image/png")},s.src="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(t))}else alert("没有可下载的图表渲染内容。")},L=()=>{let e=document.querySelector("#mermaid-chart-container svg");if(e){let t=new XMLSerializer().serializeToString(e),a=document.createElement("canvas"),r=a.getContext("2d");if(!r)return;let s=new Image;s.onload=()=>{a.width=3*s.width,a.height=3*s.height;let e=document.documentElement.classList.contains("dark");r.fillStyle=e?"#0f172a":"#ffffff",r.fillRect(0,0,a.width,a.height),r.drawImage(s,0,0,a.width,a.height),a.toBlob(e=>{if(e){let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="mermaid-diagram-".concat(Date.now(),".jpg"),document.body.appendChild(a),a.click(),document.body.removeChild(a)}},"image/jpeg",.9)},s.src="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(t))}else alert("没有可下载的图表渲染内容。")},z=()=>{let e=document.querySelector("#mermaid-chart-container svg");if(e){let t=new XMLSerializer().serializeToString(e),r=document.createElement("canvas"),s=r.getContext("2d");if(!s)return;let l=new Image;l.onload=()=>{r.width=3*l.width,r.height=3*l.height;let e=document.documentElement.classList.contains("dark");s.fillStyle=e?"#0f172a":"#ffffff",s.fillRect(0,0,r.width,r.height),s.drawImage(l,0,0,r.width,r.height),r.toBlob(e=>{if(e){let t=new FileReader;t.onload=()=>{let e,s;let l=t.result,{jsPDF:n}=a(3375),o=new n({orientation:r.width>r.height?"landscape":"portrait",unit:"mm",format:"a4"}),d=o.internal.pageSize.getWidth(),i=o.internal.pageSize.getHeight(),c=r.width/r.height;c>d/i?s=(e=d-20)/c:e=(s=i-20)*c;let m=(d-e)/2,x=(i-s)/2;o.addImage(l,"PNG",m,x,e,s),o.save("mermaid-diagram-".concat(Date.now(),".pdf"))},t.readAsDataURL(e)}},"image/png")},l.src="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(t))}else alert("没有可下载的图表渲染内容。")},O=()=>{let t=new Blob([e],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="mermaid-diagram-".concat(Date.now(),".mmd"),document.body.appendChild(r),r.click(),document.body.removeChild(r)};return(0,r.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:bg-gradient-to-br from-dark-950 to-dark-900 text-slate-900 dark:text-slate-100 font-sans relative transition-colors duration-300",children:[(0,r.jsxs)("header",{className:"h-16 border-b border-slate-200/50 dark:border-slate-800/50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md flex items-center justify-between px-6 shadow-lg shadow-slate-200/50 dark:shadow-slate-900/50 z-30 relative transition-all duration-300",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary-500 to-primary-700 flex items-center justify-center text-white font-bold text-xl shadow-glow shadow-primary-500/30",children:"M"}),(0,r.jsx)("h1",{className:"font-bold text-xl tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-primary-500 to-accent-500 dark:from-primary-400 dark:to-accent-400",children:"Mermaid AI Architect"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("a",{href:"https://github.com/yourusername/mermaid-ai-architect",target:"_blank",rel:"noopener noreferrer",className:"p-2.5 text-slate-500 hover:text-primary-500 dark:text-slate-400 dark:hover:text-primary-400 rounded-lg hover:bg-slate-100/80 dark:hover:bg-slate-800/80 backdrop-blur-sm transition-all duration-300",title:"GitHub",children:(0,r.jsx)(y.Z,{className:"w-5 h-5"})}),(0,r.jsx)("button",{onClick:()=>S(!p),className:"p-2.5 text-slate-500 hover:text-primary-500 dark:text-slate-400 dark:hover:text-primary-400 rounded-lg hover:bg-slate-100/80 dark:hover:bg-slate-800/80 backdrop-blur-sm transition-all duration-300",title:p?"切换到日间模式":"切换到夜间模式",children:p?(0,r.jsx)(N.Z,{className:"w-5 h-5"}):(0,r.jsx)(C.Z,{className:"w-5 h-5"})}),(0,r.jsxs)("button",{onClick:()=>u(!0),className:"hidden md:flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 rounded-lg shadow-lg shadow-primary-500/30 hover:shadow-xl hover:shadow-primary-500/40 transition-all duration-300",children:[(0,r.jsx)("span",{children:"\uD83D\uDCCA"}),"图表库"]}),(0,r.jsx)("div",{className:"h-6 w-px bg-slate-200/50 dark:bg-slate-700/50 mx-2 hidden md:block"}),(0,r.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(e),alert("代码已复制到剪贴板！")},className:"p-2.5 text-slate-500 hover:text-primary-500 dark:text-slate-400 dark:hover:text-primary-400 rounded-lg hover:bg-slate-100/80 dark:hover:bg-slate-800/80 backdrop-blur-sm transition-all duration-300",title:"复制 Mermaid 代码",children:(0,r.jsx)("span",{children:"\uD83D\uDCCB"})}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>E(!D),className:"p-2.5 text-slate-500 hover:text-primary-500 dark:text-slate-400 dark:hover:text-primary-400 rounded-lg hover:bg-slate-100/80 dark:hover:bg-slate-800/80 backdrop-blur-sm transition-all duration-300 flex items-center gap-1",title:"下载图表",children:[(0,r.jsx)("span",{children:"\uD83D\uDCE5"}),(0,r.jsx)(f.Z,{className:"w-4 h-4 transition-transform ".concat(D?"rotate-180":"")})]}),D&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50",children:(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsx)("button",{onClick:()=>{M(),E(!1)},className:"block px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 w-full text-left",children:"下载 SVG"}),(0,r.jsx)("button",{onClick:()=>{A(),E(!1)},className:"block px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 w-full text-left",children:"下载 PNG"}),(0,r.jsx)("button",{onClick:()=>{L(),E(!1)},className:"block px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 w-full text-left",children:"下载 JPG"}),(0,r.jsx)("button",{onClick:()=>{z(),E(!1)},className:"block px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 w-full text-left",children:"下载 PDF"}),(0,r.jsx)("button",{onClick:()=>{O(),E(!1)},className:"block px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 w-full text-left",children:"下载 Mermaid 代码"})]})})]})]})]}),(0,r.jsxs)("main",{className:"flex-1 flex overflow-hidden z-0",children:[(0,r.jsxs)("div",{className:"w-full md:w-[480px] flex flex-col border-r border-slate-200/50 dark:border-slate-800/50 bg-white/90 dark:bg-slate-900/90 backdrop-blur-md z-10 shadow-xl shadow-slate-200/50 dark:shadow-slate-900/50 transition-all duration-300 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex border-b border-slate-200/50 dark:border-slate-800/50",children:[(0,r.jsxs)("button",{onClick:()=>d("chat"),className:"flex-1 py-4 text-sm font-medium flex items-center justify-center gap-2 border-b-2 transition-all ".concat("chat"===o?"border-primary-500 text-primary-500 dark:text-primary-400 bg-slate-50/80 dark:bg-slate-800/80":"border-transparent text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"),children:[(0,r.jsx)("span",{children:"\uD83D\uDCAC"}),"AI 助手"]}),(0,r.jsxs)("button",{onClick:()=>d("code"),className:"flex-1 py-4 text-sm font-medium flex items-center justify-center gap-2 border-b-2 transition-all ".concat("code"===o?"border-primary-500 text-primary-500 dark:text-primary-400 bg-slate-50/80 dark:bg-slate-800/80":"border-transparent text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"),children:[(0,r.jsx)("span",{children:"\uD83D\uDCDD"}),"代码编辑"]})]}),(0,r.jsx)("div",{className:"flex-1 relative",children:"chat"===o?(0,r.jsx)(v,{history:l,onSendMessage:I,isLoading:i,onOptimizeText:async e=>{try{return(await j.optimizePrompt(e)).content}catch(t){return console.error("AI 优化错误:",t),e}}}):(0,r.jsx)(k,{code:e,onChange:t})})]}),(0,r.jsx)("div",{className:"flex-1 bg-gradient-to-br from-slate-100 to-slate-200 dark:bg-gradient-to-br from-dark-900 to-dark-950 relative overflow-hidden flex flex-col transition-colors duration-300",children:(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(99,102,241,0.05),transparent_70%)]"}),(0,r.jsx)(h,{code:e,onFixError:R,isFixing:m,onUpdateCode:t,onRequestChange:e=>{d("chat"),n(e=>[...e,{id:Date.now().toString(),role:"model",content:"\uD83D\uDD04 当前正在编辑的流程图已加载。请告诉我您希望如何修改这个流程图，我会根据您的需求进行调整。"}])}})]})})]}),(0,r.jsx)(w,{isOpen:b,onClose:()=>u(!1),onSelect:e=>{t(e.code),n(t=>[...t,{id:Date.now().toString(),role:"model",content:"已加载模板: ".concat(e.name)}]),u(!1)}})]})}}},function(e){e.O(0,[125,505,547,971,117,744],function(){return e(e.s=516)}),_N_E=e.O()}]);